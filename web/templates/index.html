<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notris-Online</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23000'/><rect x='10' y='10' width='20' height='20' fill='%2300FFFF'/><rect x='30' y='10' width='20' height='20' fill='%2300FFFF'/><rect x='50' y='10' width='20' height='20' fill='%2300FFFF'/><rect x='70' y='10' width='20' height='20' fill='%2300FFFF'/><rect x='20' y='30' width='20' height='20' fill='%23FFFF00'/><rect x='40' y='30' width='20' height='20' fill='%23FFFF00'/><rect x='20' y='50' width='20' height='20' fill='%23FFFF00'/><rect x='40' y='50' width='20' height='20' fill='%23FFFF00'/><rect x='60' y='70' width='20' height='20' fill='%23FF0000'/><rect x='80' y='70' width='20' height='20' fill='%23FF0000'/><rect x='60' y='90' width='20' height='20' fill='%23FF0000'/><rect x='80' y='90' width='20' height='20' fill='%23FF0000'/></svg>">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div id="app-container">
        <header id="main-header">
            <h1>Notris-Online</h1>
            <nav id="auth-nav">
                <button id="login-nav-btn" class="nav-btn">Login</button>
                <button id="register-nav-btn" class="nav-btn">Register</button>
                <div id="user-info" class="hidden">
                    <span id="username-display"></span>
                    <button id="logout-btn" class="nav-btn">Logout</button>
                </div>
            </nav>
        </header>

        <main>
            <!-- Main Menu View -->
            <div id="main-menu-view">
                <h1 id="game-title">NOTRIS ONLINE</h1>
                <div class="menu-options">
                    <button id="singleplayer-btn" class="menu-btn">Singleplayer</button>
                    <button id="multiplayer-btn" class="menu-btn">Multiplayer</button>
                    <button id="leaderboard-btn" class="menu-btn">Leaderboards</button>
                </div>
            </div>

            <!-- Level Select View -->
            <div id="level-select-view" class="hidden">
                <h2>SELECT LEVEL</h2>
                <div id="level-grid">
                    <div class="level-row">
                        <button class="level-btn" data-level="1">1</button>
                        <button class="level-btn" data-level="2">2</button>
                        <button class="level-btn" data-level="3">3</button>
                        <button class="level-btn" data-level="4">4</button>
                    </div>
                    <div class="level-row">
                        <button class="level-btn" data-level="5">5</button>
                        <button class="level-btn" data-level="6">6</button>
                        <button class="level-btn" data-level="7">7</button>
                        <button class="level-btn" data-level="8">8</button>
                    </div>
                    <div class="level-row">
                        <button class="level-btn" data-level="9">9</button>
                        <div class="level-btn-placeholder"></div>
                        <div class="level-btn-placeholder"></div>
                        <div class="level-btn-placeholder"></div>
                    </div>
                </div>
                <button id="back-to-menu-from-level-select-btn" class="menu-btn">Back to Menu</button>
            </div>

            <!-- Game View -->
            <div id="game-view" class="hidden">
                <div id="game-header">
                    <h1>NOTRIS</h1>
                    <button id="game-menu-btn" class="nav-btn">Menu</button>
                </div>
                <div id="game-container">
                    <div id="game-info">
                        <div class="info-section">
                            <h3>Score</h3>
                            <div id="score">0</div>
                        </div>
                        <div class="info-section">
                            <h3>Level</h3>
                            <div id="level">1</div>
                        </div>
                        <div class="info-section">
                            <h3>Lines</h3>
                            <div id="lines">0</div>
                        </div>
                        <div class="info-section">
                            <h3>Statistics</h3>
                            <div id="time">00:00</div>
                            <div id="ppm">0 PPM</div>
                            <div id="line-stats">
                                <div>Single: <span id="stat-single">0</span></div>
                                <div>Double: <span id="stat-double">0</span></div>
                                <div>Triple: <span id="stat-triple">0</span></div>
                                <div>Notris: <span id="stat-tetris">0</span></div>
                            </div>
                        </div>
                    </div>
                    <canvas id="game-canvas" width="400" height="800"></canvas>
                    <div id="game-info-right">
                        <div class="info-section">
                            <h3>Next</h3>
                            <canvas id="next-piece-canvas" width="120" height="80"></canvas>
                        </div>
                        <div class="info-section">
                            <h3>Hold</h3>
                            <canvas id="hold-piece-canvas" width="120" height="80"></canvas>
                        </div>
                        <div class="info-section">
                            <h3>Controls</h3>
                            <div style="font-size: 0.9em; text-align: left;">
                                <div>← → Move</div>
                                <div>↓ Soft Drop</div>
                                <div>↑ Hard Drop</div>
                                <div>Space Rotate</div>
                                <div>C/Shift Hold</div>
                                <div>Esc Pause</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game Menu Overlay -->
                <div id="game-menu-overlay" class="hidden">
                    <div id="game-menu-content">
                        <h2>Game Menu</h2>
                        <button id="resume-game-btn" class="menu-btn">Resume Game</button>
                        <button id="restart-game-btn" class="menu-btn">Restart Game</button>
                        <button id="back-to-main-menu-btn" class="menu-btn">Back to Main Menu</button>
                    </div>
                </div>
            </div>

            <!-- Multiplayer Game View -->
            <div id="multiplayer-game-view" class="hidden">
                <div id="multiplayer-game-container">
                    <!-- Player 1 (Local Player) -->
                    <div class="player-game-section">
                        <div class="player-header">
                            <h3 id="player1-name">You</h3>
                            <div class="player-stats">
                                <span>Score: <span id="player1-score">0</span></span>
                                <span>Level: <span id="player1-level">1</span></span>
                                <span>Lines: <span id="player1-lines">0</span></span>
                            </div>
                        </div>
                        <div class="game-area">
                            <div class="side-info">
                                <div class="info-section">
                                    <h4>Next</h4>
                                    <canvas id="player1-next-canvas" width="80" height="60"></canvas>
                                </div>
                                <div class="info-section">
                                    <h4>Hold</h4>
                                    <canvas id="player1-hold-canvas" width="80" height="60"></canvas>
                                </div>
                            </div>
                            <canvas id="player1-canvas" width="300" height="600"></canvas>
                        </div>
                    </div>

                    <!-- VS Indicator -->
                    <div class="vs-indicator">
                        <div class="vs-text">VS</div>
                        <div class="match-info">
                            <div id="match-timer">00:00</div>
                            <button id="multiplayer-menu-btn" class="menu-btn">Menu</button>
                        </div>
                    </div>

                    <!-- Player 2 (Opponent) -->
                    <div class="player-game-section">
                        <div class="player-header">
                            <h3 id="player2-name">Opponent</h3>
                            <div class="player-stats">
                                <span>Score: <span id="player2-score">0</span></span>
                                <span>Level: <span id="player2-level">1</span></span>
                                <span>Lines: <span id="player2-lines">0</span></span>
                            </div>
                        </div>
                        <div class="game-area">
                            <canvas id="player2-canvas" width="300" height="600"></canvas>
                            <div class="side-info">
                                <div class="info-section">
                                    <h4>Next</h4>
                                    <canvas id="player2-next-canvas" width="80" height="60"></canvas>
                                </div>
                                <div class="info-section">
                                    <h4>Hold</h4>
                                    <canvas id="player2-hold-canvas" width="80" height="60"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Multiplayer Game Menu Overlay -->
                <div id="multiplayer-game-menu-overlay" class="hidden">
                    <div id="multiplayer-game-menu-content">
                        <h2>Game Menu</h2>
                        <button id="resume-multiplayer-game-btn" class="menu-btn">Resume Game</button>
                        <button id="leave-multiplayer-game-btn" class="menu-btn">Leave Match</button>
                        <button id="back-to-multiplayer-menu-btn" class="menu-btn">Back to Multiplayer</button>
                    </div>
                </div>
            </div>

            <!-- Login View -->
            <div id="login-view" class="hidden">
                <h2>Login</h2>
                <form id="login-form">
                    <input type="text" id="login-username" name="username" placeholder="Username" required>
                    <input type="password" id="login-password" name="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                    <p class="error-message" id="login-error"></p>
                    <button type="button" class="link-btn" id="show-register-btn">Don't have an account?
                        Register</button>
                </form>
                <button id="back-to-menu-from-login-btn" class="back-btn">Back to Menu</button>
            </div>

            <!-- Register View -->
            <div id="register-view" class="hidden">
                <h2>Register</h2>
                <form id="register-form">
                    <input type="text" id="register-username" name="username" placeholder="Username" required>
                    <input type="email" id="register-email" name="email" placeholder="Email" required>
                    <input type="password" id="register-password" name="password" placeholder="Password" required>
                    <input type="password" id="register-confirm-password" name="confirmPassword"
                        placeholder="Confirm Password" required>
                    <button type="submit">Register</button>
                    <p class="error-message" id="register-error"></p>
                    <button type="button" class="link-btn" id="show-login-btn">Already have an account? Login</button>
                </form>
                <button id="back-to-menu-from-register-btn" class="back-btn">Back to Menu</button>
            </div>

            <!-- Leaderboard View -->
            <div id="leaderboard-view" class="hidden">
                <h2>Leaderboards</h2>
                <div class="leaderboard-controls">
                    <div class="filter-tabs">
                        <div class="tab-group">
                            <span class="tab-label">Time Period:</span>
                            <button class="tab-btn active" data-period="all">All Time</button>
                            <button class="tab-btn" data-period="monthly">Monthly</button>
                            <button class="tab-btn" data-period="weekly">Weekly</button>
                            <button class="tab-btn" data-period="daily">Daily</button>
                        </div>

                    </div>
                    <button id="back-to-menu-from-leaderboard-btn" class="back-btn">Back to Menu</button>
                </div>
                <div class="leaderboard-container">
                    <div id="leaderboard-content" class="leaderboard-main"></div>
                    <div id="recent-activity" class="recent-activity">
                        <h3>Recent Games</h3>
                        <div id="recent-games-list"></div>
                    </div>
                </div>
            </div>

            <!-- Multiplayer View -->
            <div id="multiplayer-view" class="hidden">
                <div id="multiplayer-tabs">
                    <button class="tab-btn active" id="room-browser-tab">Browse Rooms</button>
                    <button class="tab-btn" id="create-room-tab">Create Room</button>
                    <button class="tab-btn" id="room-lobby-tab" style="display: none;">Room Lobby</button>
                </div>

                <!-- Room Browser -->
                <div id="room-browser" class="multiplayer-section">
                    <div class="room-filters">
                        <button id="refresh-rooms-btn" class="action-btn">Refresh</button>
                    </div>
                    <div id="rooms-list" class="rooms-container">
                        <div class="loading">Loading rooms...</div>
                    </div>
                </div>

                <!-- Create Room -->
                <div id="create-room" class="multiplayer-section hidden">
                    <form id="create-room-form">
                        <div class="form-group">
                            <label for="room-name">Room Name:</label>
                            <input type="text" id="room-name" maxlength="50" required>
                        </div>
                        <div class="form-group">
                            <label for="starting-level">Starting Level:</label>
                            <select id="starting-level">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="private-room"> Private Room
                            </label>
                        </div>
                        <button type="submit" class="action-btn">Create Room</button>
                    </form>
                </div>

                <!-- Room Lobby -->
                <div id="room-lobby" class="multiplayer-section hidden">
                    <div class="lobby-header">
                        <h2 id="lobby-room-name">Room Name</h2>
                        <div class="lobby-info">
                            <span id="lobby-game-type">Tetris</span> •
                            <span id="lobby-player-count">1/2</span> players
                        </div>
                    </div>
                    <div class="lobby-content">
                        <div class="players-section">
                            <h3>Players</h3>
                            <div id="lobby-players" class="players-list"></div>
                        </div>
                        <div class="lobby-actions">
                            <button id="ready-btn" class="action-btn">Ready</button>
                            <button id="leave-room-btn" class="secondary-btn">Leave Room</button>
                        </div>
                        <div class="game-status">
                            <div id="lobby-status">Waiting for players...</div>
                        </div>
                    </div>
                </div>

                <button id="back-to-menu-from-multiplayer-btn" class="back-btn">Back to Menu</button>
            </div>
        </main>
    </div>

    <script type="module">
        // Import and initialize modules
        import { GAME_CONFIG, PIECE_COLORS, MESSAGE_TYPES } from '/static/config.js';
        import { logger } from '/static/logger.js';
        import { CanvasUtils, WebSocketUtils, DOMUtils, GameUtils, ValidationUtils } from '/static/utils.js';

        // Make available globally for non-module scripts
        window.GAME_CONFIG = GAME_CONFIG;
        window.PIECE_COLORS = PIECE_COLORS;
        window.MESSAGE_TYPES = MESSAGE_TYPES;
        window.logger = logger;
        window.CanvasUtils = CanvasUtils;
        window.WebSocketUtils = WebSocketUtils;
        window.DOMUtils = DOMUtils;
        window.GameUtils = GameUtils;
        window.ValidationUtils = ValidationUtils;
    </script>
    <script src="/static/auth.js"></script>
    <script src="/static/api.js"></script>
    <script src="/static/game.js"></script>
    <script src="/static/multiplayer.js"></script>
    <script src="/static/main.js"></script>
</body>

</html>